<html><head><title>nope</title>

<script>
var peers = {}
bridge.msgPush.connect(incomingMsg);
function incomingMsg(message){
  //msg = JSON.parse(message.message);
  id = message.peerID;
  name = message.peerName;

//make peer if missing
  if(!(id in peers)){
      peers[id] = {"name":name}
      peerPanel = "<p id='"+id+"'>"+peers[id].name+"</p>";
      document.getElementById("peerlist").innerHTML+=peerPanel;

      peerPanel =peers[id].name+" <a href=directchat.html?peerid="+id+">chat</a><br/>";
      document.getElementById("peerlistplain").innerHTML+=peerPanel;

   }

   //show peers last  message
   peerPanel = peers[id].name+"<br/>Last message="+message.message;
   document.getElementById(id).innerHTML = peerPanel

}
function testSearchold(){
    searchOptions = {"localindexed":false,"remoteindexed":true,"boolexp":true};
    var results = bridge.searchKeywords("cat", searchOptions);
    console.log(results);
}
function testSearch(){

    var input = document.getElementById('searchInput');
    //var packetdata = {"type":"chat","msg":input.value};
    //bridgeWV.broadcastMessage(JSON.stringify(packetdata));
    //document.getElementById("chatout").innerHTML+="you say:<br/>"+input.value+"<br/>";
    //input.value = "";
    
    searchTerms = input.value;
    searchOptions = {"localindexed":true,"remoteindexed":false,"boolexp":true};
    var results = bridge.searchKeywords(searchTerms, searchOptions);
    var fullpath = results[0].fullpath+results[0].srname;
    range = results.length;
    if (range>10)range=10;
    var imgpath;
    for (var i = 0;i<range;i++){
      var a = results[i].srname;
      var ext = a.slice(a.length-3,a.length);
      console.log(ext);
      if ( (ext == "png" || ext == "jpg")){
      console.log(results[i].fullpath)
      console.log(results[i].srname)
        imgpath = results[i].fullpath+results[i].srname;
        
      var imgele = "<img src='"+imgpath+"'></img>";
      document.getElementById("demo").innerHTML+=imgele;
      }else{
      document.getElementById("demo").innerHTML+=results[i].srname+"<br/>";
      }
      
    }
    //var imgele = "<img src='"+imgpath+"'></img>";
    //document.getElementById("demo").innerHTML+=imgele;
    
    console.log(results);
}
tick();

//send a message to everyone each second, so they know we are alive
function tick(){
    var packetdata = {"type":"indexping","msg":"hi there"};
    bridgeWV.broadcastMessage(JSON.stringify(packetdata));
    setTimeout(tick,1000);
}

   function searchKeyDown(e) {
       if (e.keyCode == 13) {
            testSearch();
           return false;
       }
   }
</script>
</head><body>

<p> try these pages</p>
<a href="broadcastchat.html">Broadcast Chat</a> - low data<br/>
<a href="interactiveparticles.html">Broadcast Particles</a> - medium data - paints lots of circles with three.js<br/>
<a href="phystest.html">p2p Averaging Physics Test</a> - all clients control all objects<br/>
<a href="phystest2.html">p2p owned-objects Physics Test</a> - clients control their own objects<br/>
<a href="ivank/kevents.html">Ivank simple drivable car</a> - clients control their own object<br/>
<a href="chattest.html">3d chat tree test</a> basic message+parent data is sent over the network, local 3d display<br/>
<!--
<p>old testing: Click the button to trigger a function.</p>

<br>
<button onclick="myFunction()">Click me</button>
<button onclick="testecho()">test echo</button>
<button onclick="bridgeWV.go2index2()">barefunc</button>
<button onclick="bridgeWV.go2page('index2.html')">richfunk</button>
<button onclick="bridgeWV.go2page('tindex.html')">to tindex</button>-->
<input name="searchInput" value=".png" id="searchInput" type="text" onkeypress="return searchKeyDown(event)" ></input> 
<button onclick="testSearch()">test search</button>
<p id="demo"></p>
Compatable Peers:
<p id="peerlistplain"></p>
Last packet from peers
<p id="peerlist"></p>
</body>
</html>
